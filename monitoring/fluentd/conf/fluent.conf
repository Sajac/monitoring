<source>
  @type tail
  path /var/lib/docker/containers/*/*.log
  pos_file /fluentd/log/containers.pos
  tag docker.*
  format json
  read_from_head true
</source>

<filter docker.**>
  @type record_transformer
  enable_ruby true
  <record>
    container_id ${record["container_id"]}
    container_name ${record["container_name"] || record["container_name_short"]}
  </record>
</filter>

<match **>
  @type file
  path /fluentd/log/containers.log
  append true
  <buffer time>
    timekey 60
    timekey_use_utc true
    flush_interval 10s
  </buffer>
</match>

<source>
  @type prometheus
  port 24231
  bind 0.0.0.0
</source>

<source>
  @type prometheus_monitor
</source>
