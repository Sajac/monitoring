<source>
  @type prometheus
  bind 0.0.0.0
  port 24220
</source>

<match fluent.**>
  @type prometheus_monitor
</match>

<filter docker.**>
  @type parser
  format json
  key_name message
  reserve_data true
</filter>

<filter docker.**>
  @type record_transformer
  enable_ruby
  <record>
    container_name ${tag_parts[1]}
    tag ${tag}
  </record>
</filter>

<match docker.**>
  @type file
  path /var/log/containers
  symlink_path /var/log/containers.log
  append true
  time_slice_format %Y%m%d%H%M
  compress gzip
  <buffer>
    timekey 1m
    timekey_wait 30s
    timekey_use_utc true
  </buffer>
</match>
